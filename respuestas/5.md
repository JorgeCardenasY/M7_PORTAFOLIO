# Desarrollo de la Pregunta 5

## Consultas Personalizadas con el ORM de Django

Para esta pregunta, se ha creado un proyecto Django desde cero para demostrar el uso de consultas personalizadas con el ORM de Django.

### 1. Creación del Proyecto y la Aplicación

Se creó un nuevo proyecto Django llamado `preg_5` con un entorno virtual específico. Dentro de este proyecto, se creó una aplicación llamada `bi` para albergar los modelos, vistas y plantillas relacionadas con la consulta de datos.

### 2. Definición de Modelos

Se definieron dos modelos en `bi/models.py`: `Cliente` y `Pedido`. Estos modelos representan una relación simple de uno a muchos, donde un cliente puede tener varios pedidos.

```python
from django.db import models

class Cliente(models.Model):
    nombre = models.CharField(max_length=100)
    email = models.EmailField()

    def __str__(self):
        return self.nombre

class Pedido(models.Model):
    cliente = models.ForeignKey(Cliente, on_delete=models.CASCADE)
    fecha_pedido = models.DateField()
    monto = models.DecimalField(max_digits=10, decimal_places=2)

    def __str__(self):
        return f'Pedido de {self.cliente} - {self.fecha_pedido}'
```

### 3. Migraciones

Como ya hemos mencinoado, las migraciones son una característica de Django que nos permite propagar los cambios realizados en los modelos (por ejemplo, agregar un campo, eliminar un modelo) al esquema de la base de datos. Es decir que posterior a la modificación de un modelo, se ejecuta el comando `python manage.py makemigrations` para crear un archivo de migración que prepara e implmenta los cambios. Luego, se ejecuta `python manage.py migrate` para aplicar estos cambios a la base de datos.

En este proyecto, después de definir los modelos `Cliente` y `Pedido`, se ejecutaron los siguientes comandos para crear y aplicar las migraciones:

```bash
source venv/bin/activate
python manage.py makemigrations bi
python manage.py migrate
```

Esto creó las tablas correspondientes en la base de datos SQLite.

### 4. Población de la Base de Datos

Se creó un script `populate_db.py` para agregar algunos datos de prueba a la base de datos. Este script crea instancias de los modelos `Cliente` y `Pedido`.

### 5. Creación de la Vista con Consultas Personalizadas

Se creó una vista en `bi/views.py` llamada `consultas_view` que realiza varias consultas personalizadas utilizando el ORM de Django:

-   **`filter()`**: Para recuperar todos los pedidos realizados por un cliente específico en un rango de fechas determinado.
-   **`exclude()`**: Para encontrar clientes que no han realizado ningún pedido.
-   **`get()`**: Para obtener un único cliente por su ID.
-   **`annotate()`**: Para calcular el número total de pedidos y el monto total gastado por cada cliente.

# insertarimagen de la vista preg_2/static/img/modelos_preg_5.png
![imagen de views.py](/preg_2/static/img/modelos_preg_5.png)



### 6. Creación de la Plantilla

Se creó una plantilla HTML `consultas.html` para mostrar los resultados de las consultas de una manera legible.

### 7. Configuración de URLs

Finalmente, se configuraron las URLs en `preg_5/urls.py` y `bi/urls.py` para asignar la vista `consultas_view` a una URL específica (`/consultas/`).

## Cómo Probar la Solución

1.  Navegue al directorio `preg_5`.
2.  Active el entorno virtual: `source venv/bin/activate`.
3.  Inicie el servidor de desarrollo: `python manage.py runserver`.
4.  Abra un navegador web y vaya a `http://127.0.0.1:8000/consultas/` para ver los resultados de las consultas.
